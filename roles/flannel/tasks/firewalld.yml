---

- name: Save firewalld vxlan port for flanneld
  firewalld:
    port: 8472/udp
    permanent: true
    state: enabled
    immediate: yes

- name: Save flanneld subnet traffic
  command: /bin/firewall-cmd --permanent --direct --add-rule ipv4 filter FORWARD 1
           -i flannel.1 -j ACCEPT -m comment --comment "flannel subnet"

- name: Save flanneld to DNAT'ed traffic
  command: /bin/firewall-cmd --permanent --direct --add-rule ipv4 filter FORWARD 1
           -o flannel.1 -j ACCEPT -m comment --comment "flannel subnet"

- name: Open firewalld for all inside traffic
  command: /bin/firewall-cmd --permanent --zone=trusted --add-source=192.168.0.0/16

- name: Open firewalld for all inside traffic
  command: /bin/firewall-cmd --permanent --zone=trusted --add-source=172.16.0.0/12

- name: Open firewalld for all inside traffic
  command: /bin/firewall-cmd --permanent --zone=trusted --add-source=10.0.0.0/8

- name: Enable new rules
  command: /bin/firewall-cmd --reload

